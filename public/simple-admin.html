<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Admin Dashboard - WestCoast Collectibles</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 8px; 
            padding: 30px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header { 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            margin-bottom: 30px; 
            padding-bottom: 20px; 
            border-bottom: 2px solid #eee; 
        }
        .logo { height: 40px; }
        .nav { display: flex; gap: 15px; }
        .nav a { 
            display: inline-block;
            background: #007cba; 
            color: white; 
            padding: 12px 20px; 
            text-decoration: none; 
            border-radius: 5px; 
            font-weight: bold;
        }
        .nav a:hover { background: #005a8b; }
        .nav a.green { background: #28a745; }
        .nav a.green:hover { background: #1e7e34; }
        .nav a.purple { background: #6f42c1; }
        .nav a.purple:hover { background: #5a32a3; }
        .section { 
            margin: 30px 0; 
            padding: 20px; 
            border: 1px solid #ddd; 
            border-radius: 5px; 
        }
        .section h2 { margin-top: 0; color: #333; }
        .stats { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; 
            margin: 20px 0; 
        }
        .stat-card { 
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: 8px; 
            text-align: center; 
        }
        .stat-number { font-size: 2em; font-weight: bold; color: #007cba; }
        .stat-label { color: #666; margin-top: 5px; }
        .loading { text-align: center; color: #666; }
        .error { color: red; }
        .success { color: green; }
        .product-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 20px; 
            margin-top: 20px; 
        }
        .product-card { 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            padding: 15px; 
            background: #fff;
        }
        .product-title { font-weight: bold; margin-bottom: 10px; }
        .product-info { font-size: 0.9em; color: #666; margin: 5px 0; }
        .order-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            background: #fff;
        }
        .order-header {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .order-items {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        .item {
            background: #f8f9fa;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="display: flex; align-items: center; gap: 15px;">
                <img src="/Logo.png" alt="Logo" class="logo">
                <h1>Simple Admin Dashboard</h1>
            </div>
            <div class="nav">
                <a href="#" onclick="loadProducts()">üì¶ Products</a>
                <a href="#" onclick="loadOrders()" class="green">üìã Purchase Orders</a>
                <a href="/admin-test.html" class="purple">üîß Admin Login</a>
            </div>
        </div>

        <div class="section">
            <h2>Quick Stats</h2>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="productCount">-</div>
                    <div class="stat-label">Total Products</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="inStockCount">-</div>
                    <div class="stat-label">In Stock</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="orderCount">-</div>
                    <div class="stat-label">Purchase Orders</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="inventoryValue">$-</div>
                    <div class="stat-label">Inventory Value</div>
                </div>
            </div>
        </div>

        <div class="section">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2 id="sectionTitle">Dashboard Overview</h2>
                <div id="status" class="loading">Ready</div>
            </div>
            <div id="content">
                <p>Welcome to your simple admin dashboard! Click the buttons above to manage your products and purchase orders.</p>
                <p><strong>Features:</strong></p>
                <ul>
                    <li>View all products with cost tracking</li>
                    <li>Manage purchase orders and inventory</li>
                    <li>Real-time profit calculations</li>
                    <li>Simple, fast interface that always works</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Set admin cookie
        document.cookie = 'temp-admin-access=true; path=/; max-age=86400';
        sessionStorage.setItem('tempAdminAccess', 'true');
        sessionStorage.setItem('adminUser', JSON.stringify({
            email: 'jaydenreyes32@icloud.com',
            name: 'Jayden Reyes',
            isAdmin: true
        }));

        async function loadProducts() {
            document.getElementById('sectionTitle').textContent = 'Product Management';
            document.getElementById('status').innerHTML = '<span class="loading">Loading products...</span>';
            document.getElementById('content').innerHTML = '';

            try {
                const response = await fetch('/api/admin/products', { credentials: 'include' });
                const products = await response.json();
                
                // Update stats
                document.getElementById('productCount').textContent = products.length;
                document.getElementById('inStockCount').textContent = products.filter(p => p.quantity > 0).length;
                
                const inventoryValue = products.reduce((sum, p) => sum + (parseFloat(p.total_inventory_value || 0)), 0);
                document.getElementById('inventoryValue').textContent = '$' + inventoryValue.toFixed(2);

                // Display products
                let html = '<div class="product-grid">';
                products.forEach(product => {
                    const profit = (parseFloat(product.price || 0) - parseFloat(product.total_cost || 0)).toFixed(2);
                    html += `
                        <div class="product-card">
                            <div class="product-title">${product.title || 'Untitled'}</div>
                            <div class="product-info">SKU: ${product.sku}</div>
                            <div class="product-info">Price: $${product.price || 0}</div>
                            <div class="product-info">Quantity: ${product.quantity || 0}</div>
                            <div class="product-info">Cost: $${product.total_cost || 0}</div>
                            <div class="product-info">Profit: $${profit}</div>
                            <div class="product-info">Supplier: ${product.supplier || 'N/A'}</div>
                        </div>
                    `;
                });
                html += '</div>';
                
                document.getElementById('content').innerHTML = html;
                document.getElementById('status').innerHTML = '<span class="success">‚úÖ Loaded ' + products.length + ' products</span>';
            } catch (error) {
                document.getElementById('status').innerHTML = '<span class="error">‚ùå Error loading products</span>';
                console.error(error);
            }
        }

        async function loadOrders() {
            document.getElementById('sectionTitle').textContent = 'Purchase Order Management';
            document.getElementById('status').innerHTML = '<span class="loading">Loading orders...</span>';
            document.getElementById('content').innerHTML = '';

            try {
                const response = await fetch('/api/admin/purchase-orders', { credentials: 'include' });
                const data = await response.json();
                const orders = data.purchase_orders || [];
                
                // Update stats
                document.getElementById('orderCount').textContent = orders.length;

                // Display orders
                let html = '';
                orders.forEach(order => {
                    html += `
                        <div class="order-card">
                            <div class="order-header">
                                Order ${order.id} - ${order.supplier} - ${order.purchase_date}
                            </div>
                            <div><strong>Status:</strong> ${order.status}</div>
                            <div><strong>Total Cost:</strong> $${parseFloat(order.total_cost).toFixed(2)}</div>
                            <div><strong>Notes:</strong> ${order.notes || 'None'}</div>
                            <div class="order-items">
                                <strong>Items:</strong>
                    `;
                    
                    (order.items || []).forEach(item => {
                        html += `
                            <div class="item">
                                <span>${item.product_name} (${item.quantity}x)</span>
                                <span>$${(item.unit_cost || 0).toFixed(2)} each</span>
                            </div>
                        `;
                    });
                    
                    html += '</div></div>';
                });
                
                document.getElementById('content').innerHTML = html;
                document.getElementById('status').innerHTML = '<span class="success">‚úÖ Loaded ' + orders.length + ' orders</span>';
            } catch (error) {
                document.getElementById('status').innerHTML = '<span class="error">‚ùå Error loading orders</span>';
                console.error(error);
            }
        }

        // Auto-load stats on page load
        window.addEventListener('load', () => {
            loadProducts();
        });
    </script>
</body>
</html>